<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type='text/css' href="../CSS/text.css">
    <script type="text/javascript" src="../JS/text.js"></script>
    <script src="../JS/saveJSON.js"></script>
    <script src='../JS/disposeJSON.js'></script>
    <script type="text/javascript" src="../JS/vue.js"></script>
    <title>Base Communication</title>
</head>
<body>
    <h1>If you see this message, it means that your electron application is running successfully!</h1>
    <!--<div class="listAndScreens">
        <ol id="list">
            <li v-for="user of users"> {{ user.text }}</li>
        </ol>
        <div class="screens"></div>
    </div>-->
    <!--<input id="startSocketInput" type="text">-->
    <!--<button id='startSocket'>Start socket</button>--><!--启动socket链接-->
    <!--<script type="text/javascript">
        var updateList = {
            data() {
                return {
                    users: [
                        // { text: "" }
                    ]
                }
            },
            methods: {
                addElement: function(a) {
                    this.users.push({ text: a });
                }
            }
        };
        var app = Vue.createApp(updateList).mount("#list");
    </script>-->
    <script type="module">
        var startSocket = document.createElement("button");
        startSocket.id="startSocket";
        startSocket.innerText="Start Socket";
        document.body.appendChild(startSocket);

        const ioi = require('socket.io-client');
        var socket=ioi("");

        function socketcmp() {
            setTimeout(function (){
                //if(socket.connected)
                //{
                    var messageInput = build("input");
                    messageInput.type = "text";
                    messageInput.innerText = '1';
                    messageInput.id="messageInput";

                    var messageSubmit = build("button");
                    messageSubmit.type = "submit";
                    messageSubmit.innerText = "send";
                    messageSubmit.id="messageSubmit";

                    // var newSocketIP = build('input');
                    // var newSocketIP2 = build('button');
                    // newSocketIP2.innerText = "New Socket";
                    // newSocketIP2.id = "newSocket";
                    // newSocketIP2.type = 'submit';
                    // newSocketIP.id = "newSocketInput";
                    // newSocketIP.type = 'text';

                    add(messageInput);
                    add(messageSubmit);
                    // add(newSocketIP);
                    // add(newSocketIP2);

                    $("messageSubmit").onclick = function clicked() {
                        socket.emit("clientToServer", messageInput.value);
                    }
                    /*$("startSocket").onclick = function createElement() {
                        app.addElement($("startSocketInput").value);
                    }*/
            }/*}*/, 1000);
        }

        function socketlistenEmit() {
            setTimeout(function (){
                socket.on("serverToClient", inner => {
                    console.log(inner); //For Developer
                })
            }, 1000);
        }

        $("startSocket").onclick = function click() { //监听点击事件，然后运行socket，这里用“贴标签”的形式调用socket.js

            var inputIP = build('input');
            inputIP.type = 'text';
            inputIP.id = "InputIP";

            var submitIP = build('button');
            submitIP.type = 'submit';
            submitIP.innerText = "Submit";
            submitIP.id = "socketSubmitIP";

            var endSocketIP = build('button');
            endSocketIP.innerText = "Close socket";
            endSocketIP.id = "endSocket";
            endSocketIP.type = 'submit';

            add(submitIP);
            add(endSocketIP);
            add(inputIP);

            console.log("函数被执行"); //For Developer
            $("socketSubmitIP").onclick = function submit() {
                socket = ioi("http://"+inputIP.value+":3000");
                console.log(inputIP.value);
                //readJSON();
                inputIP.remove();
                socketcmp(); //异步执行，给足时间让socket.connected进行准备
                socketlistenEmit();
            }
            $("endSocket").onclick = function endClick() {
                console.log("结束socket函数执行");
                if(socket.connected)
                {
                    setTimeout(function(){
                        socket.close();
                        inputIP.remove();
                        submitIP.remove();
                        endSocketIP.remove();
                        document.getElementById("messageInput").remove();
                        document.getElementById("messageSubmit").remove();
                    }, 2000);
                    /*messageInput.remove();
                    messageSubmit.remove();*/
                }
                else {
                    setTimeout(function(){
                        inputIP.remove();
                        submitIP.remove();
                        endSocketIP.remove();
                    }, 2000);
                }

            }
        }
    </script>
</body>
<!-- <script>

    // if(flag == 1) {
    //     delete click();
    // }
</script> -->
</html>
